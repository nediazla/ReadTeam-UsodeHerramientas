# Malware Development

* [General](#General)
* [Payload locations](#Payload-locations)
* [Payload encoding & encryption](#Payload-encoding-&-encryption)
  * [Encoding](#Encoding)
    * [Base64](#Base64)
  * [Encryption](#Encryption)
    * [XOR](#XOR)
    * [AES](#AES)
* [Code injection](#Code-injection)
  * [Classic Injections](#Classic-Injections)
    * [Injecting code in remote process](#Injecting-code-in-remote-process)
    * [Injecting DLL in remote process](#Injecting-DLL-in-remote-process)
    * [Classic injection variation](#Classic-injection-variation)
  * [Thread context injection](#Thread-context-injection)
  * [MapView Code Injection](#MapView-Code-Injection)
  * [Async Procedure Call Injection](#Async-Procedure-Call-Injection)
  * [Earlybird](#Earlybird)
* [Evasion Techniques](#Evasion-Techniques)
  * [Making a program invisible](#Making-a-program-invisible)
  * [Function call obfuscation](#Function-call-obfuscation)
  * [Hiding GetModuleHandle & GetProcAddress](#Hiding-GetModuleHandle-&-GetProcAddress)
* [Reflective DLL](#Reflective-DLL)
  * [Reflective DLL loader ](#Reflective-DLL-loader)
  * [Shellcode Reflective DLL Injection](#Shellcode-Reflective-DLL-Injection)
* [Wow64 and Heaven's Gate](#Wow64-and-Heavens-Gate)
* [API Hooking](#API-Hooking)
  * [Hooking with Detours](#Hooking-with-Detours)
  * [Hooking with Import Adress Table](#Hooking-with-Import-Adress-Table)
  * [In-line patching](#In---line-patching)
* [Payload Control](#Payload-Control)
* [Combined Droppers](#Combined-Droppers)
  * [Dropper AES Favicon](#Dropper-AES-Favicon) 
  * [Dropper XOR Favicon](#Dropper-XOR-Favicon)
  * [VeraCryptPasswordStealer](#VeraCryptPasswordStealer)
  * [Dropper Mapview Explorer](#Dropper-Mapview-Explorer)
  * [Dropper Shellcode Reflected DLL Explorer](#Dropper-Shellcode-Reflected-DLL-Explorer)

## General
- Para empezar a construir `x64 Cross Tools Command Promt for VS 2019`

#### Packer
- Crea tu propio empaquetador
  - https://www.youtube.com/watch?v=7L8r6kN_RT8
  - https://github.com/frank2/packer-tutorial

#### DebugBreak
- Desntro del dropper para agregar un breakpoint add `__debugbreak();` a la linea. agregara la intruccion `int3` para agregar un punto de intruccion.
- Run debugger  y adjuntar el PE.


#### DebugMessages
- Use `OutputDebugStringA` Función para enviar mensajes al visor de depuración desde Sysinternals.

### Dumpbin
#### Show imported functions - IAT
```
dumpbin /imports <PATH TO EXE>
```

#### Show exported functions
```
dumpbin /exports <PATH TO EXE>
```

##### Show everything
```
dumpbin /ALL <PATH TO EXE>
```

## Payload locations
- Payloads in droppers se pueden almacenar en las siguientes secciones de un PE.
	- `.text`, colóquelo dentro de una función en el código. Por ejemplo, dentro de main.
- `.data`, establece la carga útil, dentro de la variable global
- `.rdata`, establece la carga útil como de solo lectura, dentro de la variable global
- `.rsrc`, colócala en un ícono o imagen.
- Según el compilador y sus configuraciones, las secciones .data y .rdata pueden fusionarse, o incluso fusionarse en la sección .text.
- Guardar la carga útil en la sección `.rsrc` es un método más limpio, ya que las cargas útiles más grandes no se pueden almacenar en las secciones `.data` o `.rdata` debido a los límites de tamaño

#### Ejemplo de carga útil en texto
- [Example code](projects/Basics/implant_text/implant.cpp)
```
compile.bat
```


